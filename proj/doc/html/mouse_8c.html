<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Write Wise: C:/Users/igorc/lcom/g2/proj/src/lib/drivers/KBC/mouse.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Write Wise
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('mouse_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">mouse.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;lcom/lcf.h&gt;</code><br />
<code>#include &lt;lcom/utils.h&gt;</code><br />
<code>#include &quot;<a class="el" href="mouse_8h_source.html">mouse.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="i8042_8h_source.html">i8042.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="KBC_8h_source.html">KBC.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for mouse.c:</div>
<div class="dyncontent">
<div class="center"><img src="mouse_8c__incl.png" border="0" usemap="#aC_1_2Users_2igorc_2lcom_2g2_2proj_2src_2lib_2drivers_2KBC_2mouse_8c" alt=""/></div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a08895a8a691590216c1e72bbf1b2d333"><td class="memItemLeft" align="right" valign="top">int()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a08895a8a691590216c1e72bbf1b2d333">mouse_subscribe_int</a> ()</td></tr>
<tr class="memdesc:a08895a8a691590216c1e72bbf1b2d333"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subscribes mouse interrupts.  <br /></td></tr>
<tr class="separator:a08895a8a691590216c1e72bbf1b2d333"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ecf823d80520009ae5e0d76ae40a3c3"><td class="memItemLeft" align="right" valign="top">int()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a3ecf823d80520009ae5e0d76ae40a3c3">mouse_unsubscribe_int</a> ()</td></tr>
<tr class="memdesc:a3ecf823d80520009ae5e0d76ae40a3c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unsubscribes mouse interrupts.  <br /></td></tr>
<tr class="separator:a3ecf823d80520009ae5e0d76ae40a3c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f71cbe6a40c250b92b67faa3e2e2302"><td class="memItemLeft" align="right" valign="top">int()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a3f71cbe6a40c250b92b67faa3e2e2302">mouse_int_h</a> ()</td></tr>
<tr class="memdesc:a3f71cbe6a40c250b92b67faa3e2e2302"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mouse interrupt handler.  <br /></td></tr>
<tr class="separator:a3f71cbe6a40c250b92b67faa3e2e2302"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1538254b8ccba2f68e02cc3d5547722c"><td class="memItemLeft" align="right" valign="top">void()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a1538254b8ccba2f68e02cc3d5547722c">mouse_sync_bytes</a> ()</td></tr>
<tr class="memdesc:a1538254b8ccba2f68e02cc3d5547722c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes mouse synchronization bytes.  <br /></td></tr>
<tr class="separator:a1538254b8ccba2f68e02cc3d5547722c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e235868a79d1a554279c352e8a19f59"><td class="memItemLeft" align="right" valign="top">void()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a2e235868a79d1a554279c352e8a19f59">mouse_bytes_to_packet</a> ()</td></tr>
<tr class="memdesc:a2e235868a79d1a554279c352e8a19f59"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts mouse bytes to a mouse packet.  <br /></td></tr>
<tr class="separator:a2e235868a79d1a554279c352e8a19f59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1703c3c5b61eef30d724b15cafd1d75e"><td class="memItemLeft" align="right" valign="top">int()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a1703c3c5b61eef30d724b15cafd1d75e">mouse_write</a> (uint8_t command)</td></tr>
<tr class="memdesc:a1703c3c5b61eef30d724b15cafd1d75e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes a command to the mouse.  <br /></td></tr>
<tr class="separator:a1703c3c5b61eef30d724b15cafd1d75e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab482ddfd071decfbdf89450a12e535b9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#ab482ddfd071decfbdf89450a12e535b9">hookIdMouse</a> = 2</td></tr>
<tr class="separator:ab482ddfd071decfbdf89450a12e535b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4b0411f5ba8899391c182a4371ad4fc"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#af4b0411f5ba8899391c182a4371ad4fc">byteIndex</a> = 0</td></tr>
<tr class="separator:af4b0411f5ba8899391c182a4371ad4fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22259d9fbf697c6e0d093fcf4a49da75"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a22259d9fbf697c6e0d093fcf4a49da75">mouseBytes</a> [3]</td></tr>
<tr class="separator:a22259d9fbf697c6e0d093fcf4a49da75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c8d722c5804ead6dcf86ba3fe3d29c9"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a5c8d722c5804ead6dcf86ba3fe3d29c9">currentByte</a></td></tr>
<tr class="separator:a5c8d722c5804ead6dcf86ba3fe3d29c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a2e235868a79d1a554279c352e8a19f59" name="a2e235868a79d1a554279c352e8a19f59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e235868a79d1a554279c352e8a19f59">&#9670;&#160;</a></span>mouse_bytes_to_packet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void() mouse_bytes_to_packet </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts mouse bytes to a mouse packet. </p>
<p>This function converts the mouse bytes stored in the <code>mouseBytes</code> array into a mouse packet. It assigns the corresponding bytes from <code>mouseBytes</code> to the <code>mousePacket</code> structure's <code>bytes</code> array. Additionally, it extracts specific bits from the first byte of <code>mouseBytes</code> and assigns them to the relevant fields of <code>mousePacket</code> for button status, overflow flags, and delta values for the x and y axes. </p>

</div>
</div>
<a id="a3f71cbe6a40c250b92b67faa3e2e2302" name="a3f71cbe6a40c250b92b67faa3e2e2302"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f71cbe6a40c250b92b67faa3e2e2302">&#9670;&#160;</a></span>mouse_int_h()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int() mouse_int_h </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mouse interrupt handler. </p>
<p>This function is the interrupt handler for the mouse. It reads the byte from the mouse and performs the necessary actions based on the received data. If a complete packet is received, it converts the bytes to a mouse packet structure.</p>
<dl class="section return"><dt>Returns</dt><dd>0 if the byte was read successfully but a complete packet is not yet received, 1 if a complete packet is received and processed successfully, or an error code indicating the failure. </dd></dl>

</div>
</div>
<a id="a08895a8a691590216c1e72bbf1b2d333" name="a08895a8a691590216c1e72bbf1b2d333"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08895a8a691590216c1e72bbf1b2d333">&#9670;&#160;</a></span>mouse_subscribe_int()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int() mouse_subscribe_int </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subscribes mouse interrupts. </p>
<p>This function subscribes to mouse interrupts by setting the IRQ policy for the mouse interrupt line. The function sets the irqSetMouse flag to indicate that the mouse interrupt is subscribed. The IRQ policy is set to re-enable the interrupts and exclusive. The hook ID is updated with the assigned value by the system.</p>
<dl class="section return"><dt>Returns</dt><dd>Non-zero if error occured. </dd></dl>

</div>
</div>
<a id="a1538254b8ccba2f68e02cc3d5547722c" name="a1538254b8ccba2f68e02cc3d5547722c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1538254b8ccba2f68e02cc3d5547722c">&#9670;&#160;</a></span>mouse_sync_bytes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void() mouse_sync_bytes </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processes mouse synchronization bytes. </p>
<p>This function processes mouse synchronization bytes received from the mouse controller. It checks the byte index and the value of the current byte to determine whether it is the first byte or a subsequent byte. If it is the first byte, it is stored in the mouseBytes array at index 0. If it is a subsequent byte, it is stored in the <code>mouseBytes</code> array at the current byte index. The byte index is incremented accordingly. </p>

</div>
</div>
<a id="a3ecf823d80520009ae5e0d76ae40a3c3" name="a3ecf823d80520009ae5e0d76ae40a3c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ecf823d80520009ae5e0d76ae40a3c3">&#9670;&#160;</a></span>mouse_unsubscribe_int()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int() mouse_unsubscribe_int </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unsubscribes mouse interrupts. </p>
<p>This function unsubscribes mouse interrupts by removing the IRQ policy of the mouse interrupt line. The function retrieves the hook ID associated with the mouse interrupt and passes it to sys_irqrmpolicy to remove the policy. </p><dl class="section return"><dt>Returns</dt><dd>Non-zero if error occured. </dd></dl>

</div>
</div>
<a id="a1703c3c5b61eef30d724b15cafd1d75e" name="a1703c3c5b61eef30d724b15cafd1d75e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1703c3c5b61eef30d724b15cafd1d75e">&#9670;&#160;</a></span>mouse_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int() mouse_write </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>command</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes a command to the mouse. </p>
<p>This function writes a command to the mouse by sending the command byte to the Keyboard Controller. It waits for the mouse response and checks if the response is an acknowledgement (ACK). The function retries the write operation a maximum number of attempts if the acknowledgement is not received.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">command</td><td>The command byte to be sent to the mouse. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the command was written and acknowledged successfully, or 1 if an error occurred during the write operation. </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="af4b0411f5ba8899391c182a4371ad4fc" name="af4b0411f5ba8899391c182a4371ad4fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4b0411f5ba8899391c182a4371ad4fc">&#9670;&#160;</a></span>byteIndex</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t byteIndex = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5c8d722c5804ead6dcf86ba3fe3d29c9" name="a5c8d722c5804ead6dcf86ba3fe3d29c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c8d722c5804ead6dcf86ba3fe3d29c9">&#9670;&#160;</a></span>currentByte</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t currentByte</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab482ddfd071decfbdf89450a12e535b9" name="ab482ddfd071decfbdf89450a12e535b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab482ddfd071decfbdf89450a12e535b9">&#9670;&#160;</a></span>hookIdMouse</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int hookIdMouse = 2</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a22259d9fbf697c6e0d093fcf4a49da75" name="a22259d9fbf697c6e0d093fcf4a49da75"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22259d9fbf697c6e0d093fcf4a49da75">&#9670;&#160;</a></span>mouseBytes</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t mouseBytes[3]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c85d3e3c5052e9ad9ce18c6863244a25.html">lib</a></li><li class="navelem"><a class="el" href="dir_ae0e849d495154be21d419b82c842e8e.html">drivers</a></li><li class="navelem"><a class="el" href="dir_9f23c763fccc042bcbd0062e19cc9f66.html">KBC</a></li><li class="navelem"><a class="el" href="mouse_8c.html">mouse.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
